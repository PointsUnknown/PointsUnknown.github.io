<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="../../favicon.ico">
  <title>Points Unknown</title>

  <!-- Bootstrap -->
  <link href="../css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link href="../css/site-specific.css" rel="stylesheet">

  <!-- Google fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:300,400,500|Roboto:300,300i,400,400i" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body data-spy="scroll" data-target="#myScrollspy" data-offset="10">
  <!-- Fixed navbar -->
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">Points Unknown</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          <!-- <li class="active"><a href="#">Home</a></li> -->
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Courses <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="../journalism_fall2017.html">Journalism - Fall 2017</a></li>
              <li><a href="#">Journalism - Spring 2018 (A) (Coming Soon)</a></li>
              <li><a href="#">Journalism - Spring 2018 (B) (Coming Soon)</a></li>
              <li><a href="#">GSAPP - Spring 2018 (Coming Soon)</a></li>
            </ul>
          </li>
          <li class="dropdown active">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="00_InstallationInstructions.html">00 - Installation Instructions</a></li>
              <li><a href="01_BasicMap.html">01 - Basic Map</a></li>
              <li><a href="#">02 - Styling in Illustrator (Coming Soon)</a></li>
              <li><a href="03_AnnotationLayer.html">03 - Annotation Layers</a></li>
              <li><a href="04_PointData.html">04 - Working with Point Data</a></li>
              <li><a href="05_CensusJoins.html">05 - Census Data</a></li>
              <li><a href="#">06 - Digital Elevation Models (Coming Soon)</a></li>
              <li><a href="#">07 - Working with Landsat (Coming Soon)</a></li>
              <li><a href="#">08 - Change Maps (Coming Soon)</a></li>
            </ul>
          </li>
          <li><a href="../apply.html">Apply</a></li>
          <li><a href="../resources.html">Resources</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </nav>
  <div class="jumbotron">
    <div class="container">
      <h1>Tutorial 05 - Census Data and Table Joins</h1>
      <p>Using data from the U.S. Census Bureau, this tutorial will show you how to download census data, prepare and load it into QGIS, and join the data to other tables to provide geographical analysis. There are five basic steps in this process: first, select, filter and download the census data; second, prepare and load the census data to a map in QGIS; third, join the cencus data to another table in QGIS; fourth, join age attributes by location for reporting/research purposes; and fifth, style and export the map.</p>
    </div>
  </div>
  <div class="container">
    <div class="row">
      <div class="col-md-9" role="main">
        <div class="section">
          <span class="anchor" id="datasets"></span>
          <h1 class="page-header">
            Datasets
          </h1>
          <p>To create this map we will be using the following datasets for analysis:</p>
          <ul>
            <li><p>American Community Survey - Age &amp; Sex (B01001). Download from the <a href="https://factfinder.census.gov"> U.S. Census Bureau FactFinder site</a>. When you get to the Advanced Search page in FactFinder, filter 'Geographic Type' to <code>Block Group - 150</code>, State <code>New York</code>, and all Block Groups for Counties <code>Bronx, Kings, New York, Queens, and Richmond</code>. Then filter by 'Topic', and select <code>Age</code> followed by <code>Age &amp; Sex</code>. This will provide you with a list of datasets. Select dataset <code>B01001</code> from the 2015 ACS 5-year survey. A pre-packaged and edited version of this dataset can be <a href="https://brown-institute-assets.s3.amazonaws.com/Objects/ACS5Yr%20-%20B01001%20-%202015.zip" alt="pre-packaged ACS data">found here</a>.</p></li>
            <li><p>Hurricane Evacuation Zones - representing varying threat levels of coastal flooding resulting from storm surge. Download from <a href="https://data.cityofnewyork.us/Public-Safety/Hurricane-Evacuation-Zones/uihr-hn7s">NYC OpenData</a>. Once you get to the NYC OpenData page, click <code>Export</code> and choose the <code>Shapefile</code> format.
            A brief note about this dataset from NYC OpenData: "Hurricane evacuation zones should not be confused with flood insurance risk zones, which are designated by FEMA and available in the form of Flood Insurance Rate Maps (FIRMs)."</p></li>
            <li><p>Census Block Groups - New York State census block groups. Download from <a href="https://www.census.gov/cgi-bin/geo/shapefiles/index.php">U.S. Census Bureau - Tiger/Line Shapefiles</a>. Select <code>2017</code> and <code>Block Groups</code>, and click <code>Submit</code>. Then, select <code>New York</code> as the state and click <code>Download</code>.</p></li>
          </ul>
          <p>And the following datasets for styling and presentation:</p>
          <ul>
            <li><p>Boroughs - New York City boroughs. Download from <a href="http://www1.nyc.gov/site/planning/data-maps/open-data/districts-download-metadata.page">NYC Planning - Open Data</a>. Choose "Borough Boundaries (Clipped to Shoreline)", under "Borough Boundaries &amp; Community Districts".</p></li>
            <li><p>Hydrography - New York City hydrography. Download from <a href="https://data.cityofnewyork.us/Environment/Hydrography/drh3-e2fd">NYC OpenData</a>. Once you get to the NYC OpenData page, click <code>Export</code> and choose the <code>Shapefile</code> format.</p></li>
            <li><p>Hydrography U.S. - United States hydrography. Download from the <a href="https://www.rita.dot.gov/bts/sites/rita.dot.gov.bts/files/publications/national_transportation_atlas_database/2015/polygon">Bureau of Transportation Statistics</a>. When you get to the Bureau of Transportation Statistics page click on the Hydrographic Features <code>ZIP</code> file.</p></li>
            <li><p>States - U.S. State Boundaries. Download from the <a href="https://www.rita.dot.gov/bts/sites/rita.dot.gov.bts/files/publications/national_transportation_atlas_database/2015/polygon"> Bureau of Transportation Statistics</a>. When you get to the Bureau of Transportation Statistics page click on the U.S. State Boundaries <code>ZIP</code> file.</p></li>
          </ul>
          <p>A packaged file with the census and block group data can be found <a href="http://brwn.co/L2D">here</a>.</p>
        </div>
        <div class="section">
          <span class="anchor" id="aboutCensusData"></span>
          <h1 class="page-header">About the Census</h1>
          <p>For the U.S., census data is used as a key dataset in understanding the health and progress of our society. It provides metrics about our society and is used to normalize other data for identifying and measuring issues in our economy, environment, and society. This tutorial will explain the proper method for querying and downloading census data; preparing the data for qGIS; and joining, analyzing, and styling the data.</p>
          <p>For reference, the U.S. Census has two main surveys, the Decennial Census and the American Community Survey. The <a href="https://www.census.gov/history/www/programs/demographic/decennial_census.html">Decennial Census</a> is the major census survey, which is carried out every 10 years and attemps to count every person in the country. It has two major disadvantages: one, it only happens every 10 years, so for the years in between the last census might be too outdated and the next one too far away; and two, because it is not using any sampling techniques, it often under-represents minorities.</p>
          <p>The second main survey is called the <a href="https://www.census.gov/history/www/programs/demographic/american_community_survey.html">American Community Survey (ACS)</a> and happens continuously. Its questionnaire is sent to 295,000 addresses monthly and it gathers data on topics such as ancestry, educational attainment, income, language proficiency, migration, disability, employment, and housing characteristics. Its results come in 3 forms: 1-year estimates, 3-year estimates and 5-year estimates. The 1-year estimates are the most current but the least reliable. On the contrary, the 5-year estimates are not as current but are much more reliable. F</p>
        </div>
        <div class="section">
          <span class="anchor" id="downloadCensusData"></span>
          <h1 class="page-header">Downloading Census Data</h1>
          <p>The first step will be to download the 'empty' geography files for our unit of analysis (by 'empty' I mean without any census attributes, apart from unique identifiers). However, before doing this we should actually decide what unit of analysis we will use.</p>
          <p>The <a href="https://www.census.gov/programs-surveys/acs/">American Community Survey</a>, which is the statistical survey we will be using, provides data at multiple geographic levels, all the way from the whole country to the block group (which in Manhattan can be anywhere between 1 and 4 city blocks). Some of the other geographic units of analysis include regions, states, counties and metropolitan statistical areas. However, not all the data comes at every geographical level, so in general, we will try to find the smallest unit of analysis available for our dataset. In our case, that will be the block group level.</p>
          <p>Because our data is available at the block group level, we will download TIGER/Line Shapefiles for that geographical level. Download at <a href="https://www.census.gov/cgi-bin/geo/shapefiles/index.php">U.S. Census Bureau - Tiger/Line Shapefiles</a>. Select <code>2017</code> and <code>Block Groups</code>, and click <code>Submit</code>. Then, select <code>New York</code> as the state and click <code>Download</code>.</p>
          <p>Now we will fetch our data for analysis. Since we will be building a map to find the amount of our population that is both vulnerable (17 &amp; Under AND 65 &amp; older), we will need to find a dataset at the block group level that has age and population. We will need to download this for all New York City counties.<ul>
          <li><p>Once you are on the American FactFinder website, click on the <code>ADVANCED SEARCH</code> tab. Here we will search for the data at multiple levels:</p>
          <ul>
            <li><p>Geography: block groups (150) for New York City counties</p></li>
            <li><p>Dataset: American Community Survey (ACS) 2015 5-year estimates</p></li>
            <li><p>Topic: Age &amp; Sex: Age</p></li>
          </ul>
          <p>This set of criteria will quickly produce the Sex by Age dataset (B01001), which we will download and alter prior to importing into QGIS. Your final filter should should look like this:</p>
          <img class="img-responsive" src="tutorialImages/05_CensusJoins/01_AFF.jpg" alt="thumb">
        </div>
        <div class="section">
          <span class="anchor" id="preppingData"></span>
          <h1 class="page-header">Prepping Census Data for QGIS</h1>
          <p>In order to bring this census data into QGIS we need to re-format the table, so that it is correctly read by the program and we can join it to its geographic boundaries. This is a two step process: first, we will format the actual table in Excel, Google Spreadsheet or a simple text editor and, second, we will create a .csvt file, which will tell QGIS the exact format for each of the fields in the table.</p>

          <p>Again, as with many things GIS, there are multiple ways of formatting the data. In our case we could do it using Excel, Google Documents (Spreadsheet) or even a simple text editor. Here, though, I will show you how to do it through Excel. If you know how to do it in Excel you should be able to figure out how to re-format the data using a Google Docs Spreadsheet.</p>

          <p>The great advantage of using Excel (or Google Docs) is that if you need to, you can add and <strong>calculate</strong> new fields into your data; for example, in our case, you would be able to calculate the total count of vulnerable children and elderly and add that as a field (you could also do that inside QGIS). However, if you were to do that in a text editor, you would need to manually calculate the value for every single row. On the other hand, doing the re-formating through a simple text editor means that you can control the format of the data much more and that you won't have any problems with Excel auto-converting your data into other types, for example, from text into numbers or vice versa.</p>

          <p>Another great advantage of using Excel or Google Docs is that if you need to delete multiple fields (for example, all the margin of error fields), you can easily do it. Doing it in the text editor would be a nightmare. That being said, there are options, when downloading the data from American FactFinder, to not get the margin of error fields.</p>

          <p>Re-formating data in Excel:</p>
          <ul>
          <li><p>First, open a new file in Excel.</p></li>

          <li><p>Once you've opened it, click on <code>File</code>, <code>Open...</code> and navigate to the folder where you saved your downloaded census tables.</p></li>

          <li><p>Make sure you are able to open <code>All Files</code> not just <code>All Readable Files</code>. In my Mac, that option is called <code>Enable</code> and in Windows you should select the option <code>All Files (*.*)</code> instead of <code>All Excel Files (...)</code>.</p></li>

          <li><p>Once you've done this you will be able to select the file called 'ACS_15_5YR_B01001_with_ann' and open it. It should look something like this:</p></li>
          <img class="img-responsive" src="tutorialImages/05_CensusJoins/02_DataProcessing1.jpeg" alt="thumb">
          <li><p>What we need to do now is two things: One, to rename the field names (header) and get rid of the second row, which is also a kind of header. And two, delete all the margin of error fields since we are not going to use them.</p></li>

          <li><p>In terms of renaming the fields, QGIS is particular about field names. To avoid problems, limit your titles to: maximum 8 characters, no spaces, no weird characters and start with a letter, not a number.</p></li>

          <li><p>First, delete all the margin of error columns. Just right-click on the column and say <code>Delete</code>.</p></li>

          <li><p>Next, we will create a new column for Vulnerable Populations which will be the sum of all columns comprised of Females 17 and under or 65 and older, and males with the same characteristics. After calculating the sum, you can delete all other columns.</p></li>

          <li><p>Now, rename the fields in the following way:</p></li>

            <ul>
              <li><p>GeoID</p></li>
              <li><p>GeoID2</p></li>
              <li><p>GeoDesc</p></li>
              <li><p>TotPop</p></li>
              <li><p>VulPop</p></li>
            </ul>
            <br>

          <li><p>The names don't necessarily need to be like these ones. There's no standard way of naming these fields. The only thing I would recommend is to name them as close as possible to something you can actually read, so that you and the other people who use these files can easily understand what they mean. In the end, that is what metadata is there for, to tell you exactly what each of the fields means.</p></li>

          <li><p>Once you've renamed your fields, delete the second row. Now you are left with only one header field and the actual data.</p></li>

          <li><p>Finally, save your file as a .csv file. If you are on a Mac, make sure you save your file as <code>Windows Comma Separated (.csv)</code>. There seems to be a problem with the line endings when you save it as the default .csv format. I am saving my file as <code>B01001.csv</code>. It looks like the following:</li></p></ul>
          <img class="img-responsive" src="tutorialImages/05_CensusJoins/03_DataProcessing2.jpeg" alt="thumb">

          <p>Creating the .csvt file:</p>

          <ul>
          <li><p>After exporting your CSV, you will need to create a .csvt file. This file will tell QGIS exactly what type of data each of the fields is in. The different types of data your fields can take are:</p></li>

          <ul>

          <li><p>String - Represents text</p></li>

          <li><p>Integer - Represents whole numbers</p></li>

          <li><p>Real - Represents both negative and positive numbers, with decimal points</p></li>

          <li><p>Date - Date in the format YYYY-MM-DD</p></li>

          <li><p>Time - Time in the format HH:MM:SS+nn</p></li>

          <li><p>DateTime - Date and time in the format YYYY-MM-DD HH:MM:SS+nn</p></li>

        </ul>

        <p>So, for every column we need to specify what type the data is in.</p>

          <li><p>In your text editor, open a new file.</p></li>

          <li><p>Now, for every field, write the type of data it takes in quotation marks. So, for the Excel file, where we don't have the margin of error fields you would write: <code>"String","String","String","Integer","Integer"</code> Note that every item is separated by a comma and that the first three fields, even though they seem like they are numbers, are actually text fields. This is very important, since we are going to use those fields to join our census table to the census boundaries, which also contain those fields as text. If we have one file with text and another with integers or real numbers, the program won't be able to match it.</p></li>

          <li><p>If you are working on Mac's TextEdit you need to format your file as 'Plain Text'. To do this click on <code>Format</code> and then <code>Make Plain Text</code>. This will change your file from an .rtf to a simple .txt.</p></li>

          <li><p>Save your file with the same name as the table but with a different extension. It is important to do this so that QGIS understands that this .csvt file corresponds to the other .csv or .txt file. In both Windows Notepad and in Mac TextEdit you need to manually type the extension (.csvt) and in TextEdit you need to un-check the option that says 'If no extension is provided, use .txt'.</p></li>

          <li><p>If you are using the table we modified with Excel your .csvt file would be named <code>B01001.csvt</code></p></li>

          <li><p>If you were using the table we modified with TextEdit or Notepad you would name your file <code>B01001_Text_Edit.csvt</code></p></li>

          <li><p>Your final file should look something like this:</p></li></ul>
          <img class="img-responsive" src="tutorialImages/05_CensusJoins/04_DataProcessing3.jpeg" alt="thumb">
          <p>Now that the files are ready we can move into QGIS and bring everything together. A packaged version of this csv/csvt can be <a href="https://brown-institute-assets.s3.amazonaws.com/Objects/ACS5Yr%20-%20B01001%20-%202015.zip" alt="Pre-packaged AFF Data">found here</a>.</p>
        </div>
        <div class="section">
          <span class="anchor" id="importData"></span>
          <h1 class="page-header">Importing Data to QGIS</h1>
          <ul>
            <li><p>First, open a new map in QGIS and add the following layers (links at the <a href="#datasets">beginning of this tutorial</a>). Remember to add the boroughs first so that the map takes on the right projection.</p></li>
            <ul>
              <li><p>Boroughs</p></li>
              <li><p>Hurricane Evacuation Zones</p></li>
              <li><p>TIGER/Line Block Groups</p></li>
            </ul>
            <li><p>Organize your layers so that you have the hurricane evacuation zones on top, then TIGER/Line Block Groups, then boroughs. For now you can turn off the Boroughs layer.</p></li>
            <img class="img-responsive" src="tutorialImages/05_CensusJoins/05_Layers.jpeg" alt="thumb">
            <li><p>Next you will import your cleaned ACS dataset. To do so, click on <code>Add Deliminated Tex Layer</code> (Represented by a comma icon).</p></li>
            <li><p>In the menu that comes up, look for your .csv (B01001) file. Once you've selected your file QGIS will automatically select some presets. You should have the following options selected:</p></li>
            <ul>
              <li><p>File format: <code>CSV (comma separated values)</code> - this is the format our data is in: each value is separated by a comma.</p></li>
              <li><p>Record options: <code>First record has field names</code> - the first row of our file contains the field names.</p></li>
              <li><p>Geometry definition: <code>No Geometry</code> - our data has latitude and longitude data.</p></li>
              <li><p>Your menu should look something like this:</p></li>
              <img class="img-responsive" src="tutorialImages/05_CensusJoins/06_AddDTL.jpeg" alt="thumb">
            </ul>
            <li><p>Now that we have our layers loaded, we need to join our census data <code>B01001</code> to the block group geometry <code>TIGER/Line Block Groups</code>. To do so, right click on your <code>TIGER/Line Block Groups</code> and click <code>Properties</code>. On the left column, select the <code>Joins</code> tab. Here, click the <code>+ Sign</code> and a prompt will appear. For the join layer, select <code>B01001</code>, as that's the block group data we're trying to join to the block group geometry. The Join layer is <code>GEOID2</code>, as that shares the same geography identifier as the <code>TIGER/Line Block Groups - GEOID</code> identifier. Therefore, select <code>GEOID</code> as our <code>Target Field</code>. Next, select the two fields we would like to add to the geometry dataset <code>TotPop</code> and <code>VulPop</code>. Lastly, select <code>Custom field name prefix</code> and delete the text.</p> Your prompt window should look similar to this:</li>
            <img class="img-responsive" src="tutorialImages/05_CensusJoins/07_JoinPrompt.jpeg" alt="thumb">
            <li><p>After joining any dataset, the first thing you should do is check the attribute table of the recipient dataset (TIGER/Line Block Groups) and make sure you see the new columns.</p></li>
            <img class="img-responsive" src="tutorialImages/05_CensusJoins/08_JoinTest.jpeg" alt="thumb">
            <li><p>The join was successful, but in looking at the attribute table, we see that the TIGER/Line Block Groups includes counties outside of New York City. Let's filter those out by adding the following county feature filter expression (<code>"COUNTYFP" = '005' OR "COUNTYFP" = '047' OR "COUNTYFP" = '061' OR "COUNTYFP" = '081' OR "COUNTYFP" = '085'</code>) to the <code>TIGER/Line Block Groups</code> dataset.</p></li>
            <li><p>Before moving on, let's save this dataset as a shapefile with the NAD 1983 <code>EPSG:102718</code> projection.
              <ul>
                <li><p>Now you should have all the records that have latitude and longitude selected and we can proceed to export them as a shapefile.</p></li>
                <li><p>Close the attribute table, right-click on the TIGER/Line Block Groups layer and select <code>Save As...</code></p></li>
                <li><p>In the following menu choose:</p></li>
                <ul>
                  <li><p>Format: <code>ESRI Shapefile</code> - this is the same format of our other layers.</p></li>
                  <li><p>Save as: choose the appropriate location and name for your file.</p></li>
                  <li><p>CRS: <code>EPSG:102718 - NAD_1983_StatePlane_New_York_Long_Island_FIPS_3104_Feet</code> - this is the coordinate system we are working with and we want this layer to have the same one.</p></li>
                  <li><p>Check <code>Add saved file to map</code> - so that once you export the layer, the layer is added to your map.</p></li>
                </ul>
                <li><p>Once you export your layer (and it's automatically added to your map) you can group your old layer and uncheck it to hide it from the presentaiton</p></li>
              </ul>
              <p>Now, we are ready to run analysis against the hurricane evacuation zones.</p>
            </ul>
          </div>
          <div class="section">
            <span class="anchor" id="geoprocessing"></span>
            <h1 class="page-header">Geoprocessing</h1>
            <ul>
            <li><p>Using styling can be a good way to double check your work throughout the data analysis/manipulation process. Because we will be running geospatial analysis against the hurricane evacuation zone layer, let's first save the layer in the proper projection CRS: <code>EPSG:102718 - NAD_1983_StatePlane_New_York_Long_Island_FIPS_3104_Feet</code> and turn off the old hurricane evacuation zone. Now, style the evacuation zone dataset like we did in the <a href="01_BasicMap.html" alt="Basic Map Tutorial">first tutorial</a>.<p></li>
            <img class="img-responsive" src="tutorialImages/05_CensusJoins/09_StyleEvac.jpeg" alt="thumb">
            <li><p>Now, we want to find the block groups that are within the Hurricane Evacuation Zones so that we can count the amount of vulnerable population within each zone. Unfortunately, blcok group geometry doesn't neatly split at the hurricane evacuation zone--some block groups can span upwards of 5 evacuation zones. Therefore, we will want to find the proportion of area that each evacuation zone spans within a block group. We will then multiply that proportion by vulnerable population to estimate vulnerable population by zone. Note that this is not perfect. If we wanted to be more exact, we would take the PLUTO dataset and apply our population to residential area, as opposed to block group area. If you do this on your own, be sure to determine which group a building is located in by its centroid.</p></li>
            <li><p>The first thing we want to is filter out any block group without population so that we don't slow down future analysis. To do so, apply the following expression <code>"VULPOP"  != 0</code> to the Block Group layer. If we were running analysis on the total population within zones, we would filter out the total population field. For the purposes of this tutorial, I've only selected the Vulnerable Population (< 18 AND â‰¥ 65).</p></li>
            <li><p>Next, we want to add a field to the Block Group dataset that indicates the area of the block group. To do so, go into the attribute table for that layer, and select the <code>Toggle Editing Mode</code> Button. Then, click the <code>Open Field Calculator</code> button and enter the following expression <code>$area</code>. This will create a new field with area for each block group. We will title this TOTAREA. Since this is in the <code>EPSG:102718</code>, area is measured in square feet.</p></li>
            <li><p>Now, we need to run spatial analysis to determine overlaps in hurricane evacuation zones on the block groups layer. To do so, go to your menu tab and select <code>Vector</code>><code>Geoprocessing Tools</code>><code>Intersection</code>. For the Input Layer, select the 'Block Groups' dataset. For the intersect layer, select the 'Hurricane Evacuation Zones' layer. This is a good opportunity to make sure your projections are the same. This is important when performing geoprocessing analysis for most cases. This analysis is a slow process, so attached is the <a href="https://brown-institute-assets.s3.amazonaws.com/Objects/vulnerable_population_intersection.zip" alt="intersection dataset">outputted shapefile.</a></p></li>
            <img class="img-responsive" src="tutorialImages/05_CensusJoins/10_Intersection.jpeg" alt="thumb">
            <li><p>Next, we want to find out the proportion of area of cencus blocks that intersect with hurricane evacuation zones.Similar to the field calculator we applied to the Block Group dataset, let's now perform that same field analysis to the newly generated dataset.</p></li>
            <ul>
              <li><p>First, make your Attribute Table editable.</p></li>
              <li><p>Next, add a field using the field calculator for $area and title it NEWAREA.</p></li>
              <li><p>In addition, we want to find proportion so that we can measure our population across a census block group. To do so, divide new area by total area. This can be expressed as <code>"NEWAREA" / "TOTAREA"</code>. When running this calculation set the <code>Output field type</code> to 'Decimal Number (Real)', the <code>Output field length</code> to 5 and the <code>Precision</code> to 4. </p></li>
              <li><p>Last, multiply new area by vulnerable population. This can be expressed as <code>"PROP" * "VULPOP"</code>. For this calculation, set the <code>Output field type</code> to 'Decimal Number (Real)', leave the <code>Output field length</code> at 10 and the <code>Precision</code> to 2.  This will prevent the proportion and vulnerability calculations to reset to whole numbers on save. For proportion, this is particularily important.</p></li>
            </ul>
            <img class="img-responsive" src="tutorialImages/05_CensusJoins/11_Proportion.jpeg" alt="thumb">
            <li><p>As a quick check to make sure your geoprocessing worked, make the border of your new boundaries a dotted line and turn the transparency to 50%. When you zoom in, you should be able to see the old Block Group boundaries, as well as the new flood zone boundaries.</p></li>
            <img class="img-responsive" src="tutorialImages/05_CensusJoins/12_ProportionTest.jpeg" alt="thumb">
          </ul>
        </div>
        <div class="section">
          <span class="anchor" id="stylingAnalyzing"></span>
          <h1 class="page-header">Styling &amp; Analyzing</h1>
          <ul>
              <li><p>To begin styling, recreate the map generated in the <a href="01_BasicMap.html" alt="Basic Map Tutorial">first tutorial</a>, excluding the PLUTO datasets.</p></li>
              <li><p>Next, turn back on your old Block Group dataset that has block groups geography and population. In your 'Style' Properties, set the <code>Fill</code> to 'No Brush' and <code>Transparency</code> to 50%.</p></li>
              <li><p>Next, let's style the new Vulnerable Population dataset. Like the Hurricane Evacuation Zones, set the Style type to graduated, mode to 'Natural Breaks - Jenks' and clean the classification to the following breaks:</p><ul>
              <li><p>0-174</p></li>
              <li><p>175-450</p></li>
              <li><p>450-875</p></li>
              <li><p>875+</p></li>
            </ul>
          </li><li><p>It is important to understand that there are a variety of modes to make breaks in the classification of data.<ul>
              <li><p><strong>Equal Interval classification: </strong>In this mode, the width of each class is set to be the same. For example, if input values ranged between 1 and 100 and four classes were desired, then the class ranges would be 1-25, 26-50, 51-76, and 76-100 so that there are 25 values in each class.</p></li>
              <li><p><strong>Quantile (Equal Count): </strong>In this mode, the number of records in each class is distributed as equally as possible, with lower classes being overloaded with the remaining records if a perfectly equal distribution is not possible. For example, if there are fourteen records and three classes, then the lowest two classes would contain five records each and the highest class would contain four classes.</p></li>
              <li><p><strong>Natural Breaks (Jenks):</strong> The Jenks Breaks method maximizes homogeneity within classes and creates class breaks that are based on natural data trends.</p></li>
              <li><p><strong>Standard Deviation:</strong> In this mode, classes represent standard deviations above and below the mean record vlues. Based on how many classes are selected, the number of standard deviations in each class will change.</p></li>
              <li><p><strong>Pretty:</strong> This creates class boundaries that are round numbers to make it easier for humans to delineate classes.</p></li>
            </ul>
            <li><p>Last, apply a filter so that we are only seeing values for populations within hurricane evacuation zones 1-3. Now you will have a styled map that highlights vulnerable population in hurricane evacuation zones 1-3. For purposes of highlighting at risk areas, let's only display vulnerable populations above 175 people. This can be done by simply turning off the first category of classification the layers tab.</p></li>
            <img class="img-responsive" src="tutorialImages/05_CensusJoins/16_Styled.jpeg" alt="thumb">
            <li><p>While this is useful for identifying areas to report on--it is probably more helpful to run analysis on our new layers. We will want to know the overall counts of vulnerable population within each hurricane zone.</p></li>
            <li><p>To calculate the sum of vulnerable population within each hurricane evacuation zone, we need to perform basic statistical anaylsis. In QGIS, select <code>Toolbox</code> from the <code>Processing</code> tab in the overhead menu. Once selected, a new tab will appear on the right (the processing toolkit). In the processing toolkit, expand the 'QGIS Geoalgorithms' > 'Vector Table Tools' item and select <code>Statistics by Categories</code>.</p></li>
            <li><p>For <code>Input vector layer</code>, select the 'VulnerablePopulation' layer. We want the sum of the vulnerable population that's been made proportional to the sub-block groups. Therefore, select 'NEWVUL' for the <code>Field to calculate statistics on</code>. Lastly, we want the sums by evacuation zone, so please choose 'hurricane' from the <code>Field with categories</code>.</p></li>
            <img class="img-responsive" src="tutorialImages/05_CensusJoins/13_StatisticsByCat.jpeg" alt="thumb">
            <li><p>Lastly, we can go to print composer and add these statistics to a map for communication. There are a variety of maps you could make for this type of presentation. For reference, here are a couple examples:</p></li>
            <img class="img-responsive" src="tutorialImages/05_CensusJoins/16_PrintComposer2.jpeg" alt="thumb">
            <img class="img-responsive" src="tutorialImages/05_CensusJoins/15_PrintComposer1.jpeg" alt="thumb">
            <p>That said, this type of excercise (finding high risk populations in flood evacuation zones) is better served by statistical analysis and csv export than by creating a map for the public.</p>
          </ul>
        </div>
      </div>
      <div class="col-md-3" role="complementary" id="myScrollspy">
        <nav class="sidebar hidden-print hidden-sm hidden-xs" data-spy="affix" data-offset-top="420">
          <ul class="nav sidenav">
            <li><a href="#datasets">Datasets</a></li>
            <li><a href="#aboutCensusData">About Census Data</a></li>
            <li><a href="#downloadCensusData">Download Census Data</a></li>
            <li><a href="#preppingData">Prepping Census Data for QGIS</a></li>
            <li><a href="#importData">Importing Data to QGIS</a></li>
            <li><a href="#geoprocessing">Geoprocessing</a></li>
            <li><a href="#stylingAnalyzing">Styling &amp; Analyzing</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </div>

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="../js/bootstrap.min.js"></script>
</body>
</html>
